<!DOCTYPE html><html lang="zh-cn"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><title data-next-head=""></title><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/static/css/5244040820f8e06f.css" as="style"/><link rel="stylesheet" href="/static/css/5244040820f8e06f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/static/chunks/webpack-a9de24c27879d5d9.js" defer=""></script><script src="/static/chunks/framework-a4ddb9b21624b39b.js" defer=""></script><script src="/static/chunks/main-40e151073ba9b914.js" defer=""></script><script src="/static/chunks/pages/_app-c801a419d8851d78.js" defer=""></script><script src="/static/chunks/121-ea166289b6b9b64f.js" defer=""></script><script src="/static/chunks/278-09ee5e026e1c614e.js" defer=""></script><script src="/static/chunks/pages/chapter/%5BchapterId%5D-925a7a08422d18ae.js" defer=""></script><script src="/static/delumengma/_buildManifest.js" defer=""></script><script src="/static/delumengma/_ssgManifest.js" defer=""></script></head><body data-for="html-export" class="antialiased"><div id="__next"><div class="w-screen flex flex-col h-screen"><header class="flex flex-grow-0 justify-between p-4 border-b border-neutral-200"><a class="flex items-center text-2xl text-neutral-700 cursor-pointer" href="/"><img alt="得鹿梦鱼" loading="lazy" width="40" height="40" decoding="async" data-nimg="1" style="color:transparent" src="/logo.svg"/><span class="text-4 ml-4">得鹿梦鱼</span></a><div class="right flex items-center cursor-pointer"><a class="mr-2  text-md " href="/classify">知识库</a><a class="mr-2  text-md " href="/frontend">前端技能树</a><a class="mr-2  text-md " href="/question">面试题</a><a class="mr-2  text-md " href="/study">学习资料</a><a class="mr-2  text-md " href="/about">关于本人</a></div></header><div class="w-screen flex flex-1"><aside class="basis-2/12 border-r border-gray-300 h-full overflow-hidden"><div class="text-md font-bold text-gray-700 m-4">WebGIS(三)</div><div dir="ltr" class="relative overflow-hidden scroll--chapter-height" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><a class="text-md text-gray-600 block mx-4 mb-2 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap hover:text-sky-300" href="/chapter/10018_100000">杂谈</a><a class="text-md text-gray-600 block mx-4 mb-2 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap hover:text-sky-300" href="/chapter/10018_100001">WebGIS前端地图比例尺换算原理</a><a class="text-md text-gray-600 block mx-4 mb-2 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap hover:text-sky-300" href="/chapter/10018_100002">前端根据地理范围换算出瓦片行列号的原理(核心)</a><a class="text-md text-gray-600 block mx-4 mb-2 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap hover:text-sky-300" href="/chapter/10018_100003">地图瓦片在Canvas上的拼接显示原理</a><a class="text-md text-gray-600 block mx-4 mb-2 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap hover:text-sky-300" href="/chapter/10018_100004">栅格、矢量图层的本质</a><a class="text-md text-sky-300 block mx-4 mb-2 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap hover:text-sky-300" href="/chapter/10018_100005">地理坐标与屏幕坐标间的转换原理</a></div></div></div></aside><section class="basis-10/12 flex flex-col p-1"><div class="flex-1"><div dir="ltr" class="relative overflow-hidden scroll-content-height" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div id="markdown-container">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="地理坐标与屏幕坐标间的转换原理">地理坐标与屏幕坐标间的转换原理 </h1>
<p>地图本身是拥有坐标的，一般可以大致分为平面坐标和经纬度坐标，在这里我们统称为地理坐标</p>
<h2 id="转换前提">转换前提 </h2>
<ol>
<li>知道屏幕的最左上角所对应的真实的地理坐标（screenGeoBounds.left, screenGeoBounds.top）。</li>
<li>知道此时的地图所在级别上每个瓦片所对应的实际地理长度(sliceLevelLength)。</li>
<li>知道瓦片的大小，即一个瓦片所拥有的屏幕像素(tileSize)。</li>
</ol>
<h2 id="转换公式">转换公式 </h2>
<h3 id="屏幕坐标转换为地理坐标">屏幕坐标转换为地理坐标 </h3>
<p>geoXY.x = screenGeoBounds.left + screenX * sliceLevelLength / tileSize;</p>
<p>geoXY.y = screenGeoBounds.top - screenY * sliceLevelLength / tileSize;</p>
<h4 id="地理坐标转换为屏幕坐标">地理坐标转换为屏幕坐标 </h4>
<p>screenXY.x = (geoX - screenGeoBounds.left)/(sliceLevelLength/ tileSize);</p>
<p>screenXY.y = (screenGeoBounds.top - geoY)/(sliceLevelLength/ tileSize);</p>

      </div>
      <div class="md-sidebar-toc">
<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#地理坐标与屏幕坐标间的转换原理" class="md-toc-link"><p>地理坐标与屏幕坐标间的转换原理</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#转换前提" class="md-toc-link">
            <p>转换前提</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#转换公式" class="md-toc-link"><p>转换公式</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#屏幕坐标转换为地理坐标" class="md-toc-link"><p>屏幕坐标转换为地理坐标</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#地理坐标转换为屏幕坐标" class="md-toc-link">
            <p>地理坐标转换为屏幕坐标</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    
</div>
</div>
      <a id="sidebar-toc-btn">≡</a>
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </div></div></div></div></div><div class="flex justify-between"><div class="visible border min-w-60 h-10 px-4 leading-10 border-gray-300 text-center cursor-pointer rounded-md hover:text-sky-300">栅格、矢量图层的本质</div><div class="invisible border min-w-60 px-4  h-10 leading-10 border-gray-300 text-center cursor-pointer rounded-md hover:text-sky-300"></div></div></section></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"bookInfo":{"id":"10018","name":"WebGIS(三)","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)","chapterList":[{"id":"10018_100000","type":"chapter","name":"杂谈","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\01杂谈.md","url":"/chapter/10018_100000","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"webgis杂谈\"\u003eWebGIS杂谈 \u003c/h1\u003e\n\u003ch2 id=\"gis定义\"\u003eGIS定义 \u003c/h2\u003e\n\u003cp\u003eGIS的全名是Geographic Information System，中文全名是地理信息系统。它是在计算机硬、软件系统支持下，对整个或部分地球表层（包括大气层）空间中的有关地理分布数据进行采集、储存、管理、运算、分析、显示和描述的技术系统。\u003c/p\u003e\n\u003ch2 id=\"gis学科\"\u003eGIS学科 \u003c/h2\u003e\n\u003cp\u003eGIS是利用测绘生成纸制地图或者航拍以及卫星等生成影像后，将这些数据存储在计算机中，以地图或图片的形式表现出来，然后根据实际生产生活以及科研中的各种需求，进而提供具体的经过处理后的数据。\u003c/p\u003e\n\u003ch2 id=\"webgis简介\"\u003eWebGIS简介 \u003c/h2\u003e\n\u003cp\u003eWebGIS就是展现于网络上的GIS。在上世纪八十年开始，出现的大量GIS软件，基本上都是C/S架构的，也就是首先需要在本机上装有专业的GIS软件，然后用户根据需求使用这些GIS软件。当然这种桌面端的GIS软件有其天然的优势，比如开发相对简单，不需要Internet支持，以及可以做更多的复杂功能、响应相对迅速等优势。但是同时，其缺点更是不容忽视。首当其冲的便是不便于推广，而不便于推广的原因在于C/S系统其本身的天然的劣势：不便于更新，不便于跨平台，不便于用户在不安装指定客户端的情况下使用。\u003c/p\u003e\n\u003cp\u003eWebGIS，就是将GIS这门学科所能提供的功能，以B/S技术展现给用户，使用户只需要在浏览器上便能使用这些GIS功能的一个应用方向。\u003c/p\u003e\n\u003ch2 id=\"国内webgis行业\"\u003e国内WebGIS行业 \u003c/h2\u003e\n\u003cp\u003e目前使用WebGIS技术的公司可以大致分为两个方向：一个是互联网方向，一个是行业应用方向\u003c/p\u003e\n\u003cp\u003e国内的互联网方向里基本可以说已经被百度地图，腾讯地图，高德地图，三个巨头垄断。所以对于想从事互联网方向的WebGIS开发人员，其实可以选择的大公司并不多。\u003c/p\u003e\n\u003ch2 id=\"webgis框架\"\u003eWebGIS框架 \u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/100000063.png\" alt=\"WebGIS框架\"\u003e\u003c/p\u003e\n\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#webgis杂谈\" class=\"md-toc-link\"\u003e\u003cp\u003eWebGIS杂谈\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#gis定义\" class=\"md-toc-link\"\u003e\n            \u003cp\u003eGIS定义\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#gis学科\" class=\"md-toc-link\"\u003e\n            \u003cp\u003eGIS学科\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#webgis简介\" class=\"md-toc-link\"\u003e\n            \u003cp\u003eWebGIS简介\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#国内webgis行业\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e国内WebGIS行业\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#webgis框架\" class=\"md-toc-link\"\u003e\n            \u003cp\u003eWebGIS框架\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "},{"id":"10018_100001","type":"chapter","name":"WebGIS前端地图比例尺换算原理","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\02WebGIS前端地图比例尺换算原理.md","url":"/chapter/10018_100001","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"webgis前端地图比例尺换算原理\"\u003eWebGIS前端地图比例尺换算原理 \u003c/h1\u003e\n\u003ch2 id=\"地图比例尺中的scale和resolution\"\u003e地图比例尺中的Scale和Resolution \u003c/h2\u003e\n\u003cp\u003eScale表示的是比例尺，即地图上的一厘米代表着实际上的多少厘米\u003c/p\u003e\n\u003cp\u003eResolution表示的是分辨率。Resolution 的实际含义代表当前地图范围内，1像素代表多少地图单位（X地图单位/像素），地图单位取决于数据本身的空间参考。可见Resolution跟 dpi有关系（dpi代表每英寸的像素数），跟地图的单位也有关系。\u003c/p\u003e\n\u003ch2 id=\"行列号瓦片存放地址的标识\"\u003e行列号——瓦片存放地址的标识 \u003c/h2\u003e\n\u003cp\u003e把一张矩形的地图，按照一定的规律（按照切图原点，切图范围，瓦片大小），分成了很多个大小相同的矩形，那么这个矩形所在位置，我么基本上是可以用Row和Col来表示出来。当然，如果我们了解影像金字塔这个概念，那么前面还要加上一个Level（影像级别），说通俗点就是你目前切割的这个矩形是属于整个影像中的哪一层的。\u003c/p\u003e\n\u003ch3 id=\"幕上1像素代表的实际距离是多少\"\u003e幕上1像素代表的实际距离是多少 \u003c/h3\u003e\n\u003cp\u003e在计算瓦片的行列号之前，我们需要得到图上一像素代表实际距离多少米。现在假设地图的坐标单位是米，dpi为96\u003c/p\u003e\n\u003cp\u003e1英寸=2.54厘米\u003cbr\u003e\n1英寸=96像素\u003cbr\u003e\n最终换算的单位是米；\u003cbr\u003e\n如果当前地图比例尺为1:125000000，则代表图上1米等于实地125000000米；\u003cbr\u003e\n米和像素间的换算公式：\u003cbr\u003e\n1英寸=0.0254米=96像素\u003cbr\u003e\n1像素=0.0254/96 米\u003cbr\u003e\n则根据1:125000000比例尺，图上1像素代表实地距离是 125000000*0.0254/96 = 33072.9166666667米。\u003c/p\u003e\n\u003ch3 id=\"平面坐标系和经纬度坐标系中的比例尺\"\u003e平面坐标系和经纬度坐标系中的比例尺 \u003c/h3\u003e\n\u003ch4 id=\"平面坐标系中的比例尺\"\u003e平面坐标系中的比例尺 \u003c/h4\u003e\n\u003cp\u003e当数据库为平面坐标系统时，此时系统中所需的比例尺应该从scale中取得。因为原scale中表示的实际单位是厘米，而我们系统中需要的单位是米，所以在填写地图比例尺时，会将scale除以一百后再填写。\u003c/p\u003e\n\u003ch4 id=\"经纬度坐标系中的比例尺\"\u003e经纬度坐标系中的比例尺 \u003c/h4\u003e\n\u003cp\u003e当数据库为经纬度坐标系统时，此时系统中所需的比例尺应该从resolution中取得。此时的resolution直接代表了地图上一像素等于实际中的多少度。\u003c/p\u003e\n\u003cp\u003e但是，因为代码中已经有了一个如第二节中所描述的一个转换算法，所以此时在填写数据库中比例尺时，需要将此算法逆向换算后再填入。\u003c/p\u003e\n\u003cp\u003e即：resolution*96/inch2centimeter\u003c/p\u003e\n\u003ch3 id=\"英寸转厘米所引发的问题\"\u003e英寸转厘米所引发的问题 \u003c/h3\u003e\n\u003cp\u003e英寸转厘米的国际参数是：2.5399998，当利用天地图或者其他第三方非AGS切图的地图时，都可使用这个参数值。\u003c/p\u003e\n\u003cp\u003e但是，当用AGS所切之图时，此参数变成了：2.54000508001016。这可能是AGS自己内部定义的一个转换参数。\u003c/p\u003e\n\u003cp\u003e根据参数的不同，当我们换算经纬度坐标系下的比例尺时，要根据不同的参数来进行转换。当是AGS地图时，则为：resolution*96/2.54000508001016。\u003c/p\u003e\n\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#webgis前端地图比例尺换算原理\" class=\"md-toc-link\"\u003e\u003cp\u003eWebGIS前端地图比例尺换算原理\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#地图比例尺中的scale和resolution\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e地图比例尺中的Scale和Resolution\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#行列号瓦片存放地址的标识\" class=\"md-toc-link\"\u003e\u003cp\u003e行列号——瓦片存放地址的标识\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#幕上1像素代表的实际距离是多少\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e幕上1像素代表的实际距离是多少\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#平面坐标系和经纬度坐标系中的比例尺\" class=\"md-toc-link\"\u003e\u003cp\u003e平面坐标系和经纬度坐标系中的比例尺\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#平面坐标系中的比例尺\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e平面坐标系中的比例尺\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#经纬度坐标系中的比例尺\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e经纬度坐标系中的比例尺\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#英寸转厘米所引发的问题\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e英寸转厘米所引发的问题\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "},{"id":"10018_100002","type":"chapter","name":"前端根据地理范围换算出瓦片行列号的原理(核心)","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\03前端根据地理范围换算出瓦片行列号的原理(核心).md","url":"/chapter/10018_100002","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"前端根据地理范围换算出瓦片行列号的原理核心\"\u003e前端根据地理范围换算出瓦片行列号的原理(核心) \u003c/h1\u003e\n\u003ch2 id=\"影像金字塔简介\"\u003e影像金字塔简介 \u003c/h2\u003e\n\u003cp\u003e影像金字塔就是，我们首先将原始影像按照用户的需求，比如用户需要显示多少种比例尺下的数据，需要显示的是原始影像中的哪个区域的数据，将原始影像按照这些需求进行划分和提取\u003c/p\u003e\n\u003cp\u003e最低层就是我们提取和划分出的比例尺最小的一级的瓦片，而最上层的则是比例尺最大的一级的瓦片。我们仔细观察可以发现这样的一个规律：比例尺越小的级别瓦片数据越少，反之则越大。而这个规律导致的结果就是：比例尺越小的级别切图的速度越快，同时，同样大小的瓦片所包含的影像范围越多。\u003c/p\u003e\n\u003cp\u003e当我们建立好了影像金子塔后，前端再请求地图时，则将只是在切好的瓦片缓存中，找到对应级别里对应的瓦片即可。然后在前端将这些请求到的瓦片拼接出来，便可以得到用户需要的级别下的可视范围内的瓦片了。\u003c/p\u003e\n\u003ch2 id=\"瓦片行列号的换算原理\"\u003e瓦片行列号的换算原理 \u003c/h2\u003e\n\u003cp\u003e假设，地图切图的原点是（x0,y0），地图的瓦片大小是tileSize，地图屏幕上1像素代表的实际距离是resolution。计算坐标点（x,y）所在的瓦片的行列号的公式是：\u003c/p\u003e\n\u003cp\u003ecol = floor((x0 - x)/( tileSize*resolution))\u003c/p\u003e\n\u003cp\u003erow = floor((y0 - y)/( tileSize*resolution))\u003c/p\u003e\n\u003cp\u003e简单点说就是，首先算出一个瓦片所包含的实际长度是多少LtileSize，然后再算出此时屏幕上的地理坐标点离瓦片切图的起始点间的实际距离LrealSize，然后用实际距离除以一个瓦片的实际长度，即可得此时的瓦片行列号：LrealSize/LtileSize。\u003c/p\u003e\n\u003ch2 id=\"换算流程\"\u003e换算流程 \u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eoriginX,originY：地图切图时的切图原点坐标。\u003c/li\u003e\n\u003cli\u003etileSize：瓦片的屏幕像素大小。\u003c/li\u003e\n\u003cli\u003eLevel：地图级别。\u003c/li\u003e\n\u003cli\u003eresolution：某地图级别下屏幕一像素代表的实际单位大小。\u003c/li\u003e\n\u003cli\u003ecanvasWidth、canvasHeight：屏幕的长宽\u003c/li\u003e\n\u003cli\u003egeoMaxX、geoMinX：地理范围中的最大、最小X坐标。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"获得请求地理范围中的中心点centergeopoint\"\u003e获得请求地理范围中的中心点（centerGeoPoint） \u003c/h3\u003e\n\u003cp\u003e为什么我们要首先换算这个中心点呢。原因是我们最后需要的真实地理范围，并不一定是屏幕范围所对应的那个地理范围，它极有可能是大于这个屏幕地理范围的。而事实上是，它一定是大于的，在后面我们讲解瓦片图层类的设计时，会提到一个地理范围缓冲宽度，那时候大家就更能明白为什么是要首先获取地理范围中的中心点了。\u003c/p\u003e\n\u003ch3 id=\"判断请求中是否包含了需要显示的地图级别分别处理\"\u003e判断请求中是否包含了需要显示的地图级别，分别处理 \u003c/h3\u003e\n\u003ch4 id=\"包含了level\"\u003e包含了Level \u003c/h4\u003e\n\u003cp\u003e如果请求中已经指定了使用的Level，则我们接下来可以直接使用此Level来进行地图实际请求范围的换算。\u003c/p\u003e\n\u003ch4 id=\"没有包含level\"\u003e没有包含Level \u003c/h4\u003e\n\u003cp\u003e当请求中无Level时，我们的换算将会比较复杂一些，这个换算的目的就是求出此时的地图应该以什么Level显示是最合适的，即nearestLevel。它的过程是，首先根据请求中的地理范围和屏幕大小范围，求得此时我们本需要的瓦片实际大小，即：(geoMaxX-geoMinX)/( canvasWidth/tileSize)，也就是用实际地理长度除以此时的瓦片个数，从而得到了我们请求中本需求的瓦片实际大小\u003c/p\u003e\n\u003cp\u003e但是，目前我们不能保证我们所切的图中是一定有这个需求里的比例尺的。于是我们还需要做一个遍历，遍历我们的地图中所有的比例尺，找出一个与此需求比例尺下的瓦片实际大小最贴近的真实瓦片实际大小，而这个瓦片实际大小所对应的此时的地图比例尺，即是我们求得到的最合适的比例尺，它所代表的地图级别就是最贴近需求的地图级别，nearestLevel。\u003c/p\u003e\n\u003ch3 id=\"算出屏幕范围所对应的地理范围-minx-miny-maxx-maxy\"\u003e算出屏幕范围所对应的地理范围 (minX、minY、maxX、maxY) \u003c/h3\u003e\n\u003cp\u003e首先得到Level下的一像素代表的实际大小，即resolution。然后用centerGeoPoint加上或减去半个屏幕长度（canvasBounds）乘以resolution后得到的范围便是需求中的屏幕范围在获得的Level下应该对应的实际地理范围。\u003cbr\u003e\n以屏幕左上角X所对应的实际地理坐标为例：\u003cbr\u003e\nminX =centerGeoPoint - (resolution* canvasWidth)/2;\u003cbr\u003e\n这里顺便提一下，算出的这个屏幕范围所对应的地理范围，它的作用是非常大的，在以后的屏幕坐标转换成地理坐标，以及地理坐标转换成屏幕坐标，还有偏移补偿量的换算上是至关重要的一个参数。\u003c/p\u003e\n\u003ch3 id=\"瓦片起始行列号fixedtilelefttopnumx-fixedtilelefttopnumy\"\u003e瓦片起始行列号(fixedTileLeftTopNumX、fixedTileLeftTopNumY) \u003c/h3\u003e\n\u003cp\u003e我们算出来的地理范围并不能保证真实的瓦片的起始瓦片所对应的地理坐标与地理范围的左上角地理范围重合，为此我们应该允许地理范围的一个扩张，这个扩张多少是一个很值得推敲的地方。这里我们默认为扩张至请求到的第一张瓦片左上角所对应的地理坐标。\u003c/p\u003e\n\u003cp\u003efixedTileLeftTopNumX = Math.floor((Math.abs(originX - minX))/resolution*tileSize);\u003c/p\u003e\n\u003cp\u003efixedTileLeftTopNumY = Math.floor((Math.abs(originY - maxY))/resolution*tileSize);\u003c/p\u003e\n\u003ch3 id=\"实际地理范围realminx-realmaxy\"\u003e实际地理范围(realMinX、realMaxY) \u003c/h3\u003e\n\u003cp\u003erealMinX = fixedTileLeftTopNumX * curLevelClipLength + originX;\u003c/p\u003e\n\u003cp\u003erealMaxY= originY - fixedTileLeftTopNumY * curLevelClipLength;\u003c/p\u003e\n\u003ch3 id=\"左上角偏移像素offsetx-offsety\"\u003e左上角偏移像素(offSetX、offSetY) \u003c/h3\u003e\n\u003cp\u003e由于地理范围中的第一张瓦片，即左上角的第一张瓦片，并不一定是完全包含在屏幕地理范围内的，于是这里又涉及到另外一对参数，左上角偏移像素。\u003c/p\u003e\n\u003cp\u003e为什么要求这个参数呢，原因是，当我们把瓦片都请求回来后还要做一个换算，即换算出每一张瓦片的左上角坐标应该对应在图层（TIleCanvas）上的哪一个屏幕坐标。这个偏移像素便是为了这个换算而做的准备。\u003c/p\u003e\n\u003cp\u003eoffSetX = ((realMinX- minX )/resolution);\u003c/p\u003e\n\u003cp\u003eoffSetY = ((maxY - realMaxY )/resolution);\u003c/p\u003e\n\u003ch3 id=\"x-y轴上的瓦片个数mapxclipnum-mapyclipnum\"\u003eX、Y轴上的瓦片个数(mapXClipNum、mapYClipNum) \u003c/h3\u003e\n\u003cp\u003emapXClipNum = Math.ceil((canvasWidth + Math.abs(offSetX))/tileSize);\u003c/p\u003e\n\u003cp\u003emapYClipNum = Math.ceil((canvasHeight + Math.abs(offSetY))/tileSize);\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/100000064.png\" alt=\"换算流程\"\u003e\u003c/p\u003e\n\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#前端根据地理范围换算出瓦片行列号的原理核心\" class=\"md-toc-link\"\u003e\u003cp\u003e前端根据地理范围换算出瓦片行列号的原理(核心)\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#影像金字塔简介\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e影像金字塔简介\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#瓦片行列号的换算原理\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e瓦片行列号的换算原理\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#换算流程\" class=\"md-toc-link\"\u003e\u003cp\u003e换算流程\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#获得请求地理范围中的中心点centergeopoint\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e获得请求地理范围中的中心点（centerGeoPoint）\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#判断请求中是否包含了需要显示的地图级别分别处理\" class=\"md-toc-link\"\u003e\u003cp\u003e判断请求中是否包含了需要显示的地图级别，分别处理\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#包含了level\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e包含了Level\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#没有包含level\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e没有包含Level\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#算出屏幕范围所对应的地理范围-minx-miny-maxx-maxy\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e算出屏幕范围所对应的地理范围 (minX、minY、maxX、maxY)\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#瓦片起始行列号fixedtilelefttopnumx-fixedtilelefttopnumy\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e瓦片起始行列号(fixedTileLeftTopNumX、fixedTileLeftTopNumY)\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#实际地理范围realminx-realmaxy\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e实际地理范围(realMinX、realMaxY)\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#左上角偏移像素offsetx-offsety\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e左上角偏移像素(offSetX、offSetY)\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#x-y轴上的瓦片个数mapxclipnum-mapyclipnum\" class=\"md-toc-link\"\u003e\n            \u003cp\u003eX、Y轴上的瓦片个数(mapXClipNum、mapYClipNum)\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "},{"id":"10018_100003","type":"chapter","name":"地图瓦片在Canvas上的拼接显示原理","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\04地图瓦片在Canvas上的拼接显示原理.md","url":"/chapter/10018_100003","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"地图瓦片在canvas上的拼接显示原理\"\u003e地图瓦片在Canvas上的拼接显示原理 \u003c/h1\u003e\n\u003ch2 id=\"任意瓦片屏幕坐标的计算\"\u003e任意瓦片屏幕坐标的计算 \u003c/h2\u003e\n\u003cp\u003eoffSetX、offSetY：最左上角瓦片的屏幕坐标\u003c/p\u003e\n\u003cp\u003eclipX、clipY：目前瓦片的行列号\u003c/p\u003e\n\u003cp\u003efixedTileLeftTopNumY、fixedTileLeftTopNumY：最左上角瓦片的行列号\u003c/p\u003e\n\u003cp\u003etileSize：瓦片大小（一张瓦片的像素）\u003c/p\u003e\n\u003cp\u003ecoord:目前瓦片的屏幕坐标\u003c/p\u003e\n\u003cp\u003ecoord.x = offSetX + ( clipX - fixedTileLeftTopNumX)* tileSize;\u003c/p\u003e\n\u003cp\u003ecoord.y = offSetY + ( clipY - fixedTileLeftTopNumY)* tileSize;\u003c/p\u003e\n\u003ch2 id=\"瓦片拼接流程\"\u003e瓦片拼接流程 \u003c/h2\u003e\n\u003cpre data-role=\"codeBlock\" data-info=\"\" class=\"language-text\"\u003e\u003ccode\u003e遍历x轴上瓦片\n    遍历y轴上的瓦片\n      获得当前遍历到的瓦片的屏幕坐标，通过瓦片URL下载后，添加到canvas对应的坐标  \n\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#地图瓦片在canvas上的拼接显示原理\" class=\"md-toc-link\"\u003e\u003cp\u003e地图瓦片在Canvas上的拼接显示原理\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#任意瓦片屏幕坐标的计算\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e任意瓦片屏幕坐标的计算\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#瓦片拼接流程\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e瓦片拼接流程\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "},{"id":"10018_100004","type":"chapter","name":"栅格、矢量图层的本质","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\05栅格、矢量图层的本质.md","url":"/chapter/10018_100004","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"栅格-矢量图层的本质\"\u003e栅格、矢量图层的本质 \u003c/h1\u003e\n\u003ch2 id=\"何为栅格数据何为矢量数据\"\u003e何为栅格数据，何为矢量数据？ \u003c/h2\u003e\n\u003cp\u003e在GIS中，对于数据格式的分类，我们一般会将其分为栅格数据和矢量数据两种类型。栅格数据是将空间看做离散的像元，由二维数组或者其他数据组织方式来进行表达。矢量数据恰恰相反，它将空间看成是连续的，用要素（点、线、面）来进行表达。\u003c/p\u003e\n\u003cp\u003e我们把栅格数据和矢量数据的特点归纳如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e栅格数据是离散的，矢量数据是连续的。所以栅格数据多用二维数组（行、列）的方式组织。而矢量数据可以理解为一种向量，它用平面坐标（X、Y）的有序几何来组织。\u003c/li\u003e\n\u003cli\u003e栅格数据的最小单位是像素，矢量数据的最小单位是要素。\u003c/li\u003e\n\u003cli\u003e栅格数据的属性由像素的像素值来表示，矢量数据的属性由要素的属性来表示。\u003c/li\u003e\n\u003cli\u003e拓扑关系是基于矢量数据的。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdl\u003e\n\u003cdt\u003eWebGIS中，地形图本身是栅格数据还是矢量数据\u003c/dt\u003e\n\u003cdd\u003e地形图也就是由PNG或其他格式组成的一张图片而已。图片本身是由离散的像素在二维方向上组成的，而这正是栅格数据的组织方式，所以WebGIS中，我们得到的地形图可以理解为一种栅格图层。\u003c/dd\u003e\n\u003cdt\u003e用户需要与图层交互时，比如需要图层响应点击事件，返回点击处的属性，此时图层是用栅格的数据方式显示，还是矢量数据方式显示？\u003c/dt\u003e\n\u003cdd\u003e鼠标点击到图层上的某处，需要返回此时点击处的属性。栅格数据是由像素值来表示属性的，所以它是不能满足用户需求的。这里，我们只能用矢量图层来完成这个需求。那么怎么完成呢？一般来说，有两种方式，分别是前台实现需求和后台实现需求\u003c/dd\u003e\n\u003cdt\u003e需要判断两个图层的拓扑关系，比如判断房屋图层中哪些房屋落在了绿地图层中的绿地里，此时是用栅格图层还是矢量图层？\u003c/dt\u003e\n\u003cdd\u003e只能选择矢量图层来完成需求。拓扑关系的判断是只有矢量图层可以进行的\u003c/dd\u003e\n\u003c/dl\u003e\n\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#栅格-矢量图层的本质\" class=\"md-toc-link\"\u003e\u003cp\u003e栅格、矢量图层的本质\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#何为栅格数据何为矢量数据\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e何为栅格数据，何为矢量数据？\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "},{"id":"10018_100005","type":"chapter","name":"地理坐标与屏幕坐标间的转换原理","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\06地理坐标与屏幕坐标间的转换原理.md","url":"/chapter/10018_100005","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"地理坐标与屏幕坐标间的转换原理\"\u003e地理坐标与屏幕坐标间的转换原理 \u003c/h1\u003e\n\u003cp\u003e地图本身是拥有坐标的，一般可以大致分为平面坐标和经纬度坐标，在这里我们统称为地理坐标\u003c/p\u003e\n\u003ch2 id=\"转换前提\"\u003e转换前提 \u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e知道屏幕的最左上角所对应的真实的地理坐标（screenGeoBounds.left, screenGeoBounds.top）。\u003c/li\u003e\n\u003cli\u003e知道此时的地图所在级别上每个瓦片所对应的实际地理长度(sliceLevelLength)。\u003c/li\u003e\n\u003cli\u003e知道瓦片的大小，即一个瓦片所拥有的屏幕像素(tileSize)。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"转换公式\"\u003e转换公式 \u003c/h2\u003e\n\u003ch3 id=\"屏幕坐标转换为地理坐标\"\u003e屏幕坐标转换为地理坐标 \u003c/h3\u003e\n\u003cp\u003egeoXY.x = screenGeoBounds.left + screenX * sliceLevelLength / tileSize;\u003c/p\u003e\n\u003cp\u003egeoXY.y = screenGeoBounds.top - screenY * sliceLevelLength / tileSize;\u003c/p\u003e\n\u003ch4 id=\"地理坐标转换为屏幕坐标\"\u003e地理坐标转换为屏幕坐标 \u003c/h4\u003e\n\u003cp\u003escreenXY.x = (geoX - screenGeoBounds.left)/(sliceLevelLength/ tileSize);\u003c/p\u003e\n\u003cp\u003escreenXY.y = (screenGeoBounds.top - geoY)/(sliceLevelLength/ tileSize);\u003c/p\u003e\n\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#地理坐标与屏幕坐标间的转换原理\" class=\"md-toc-link\"\u003e\u003cp\u003e地理坐标与屏幕坐标间的转换原理\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#转换前提\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e转换前提\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#转换公式\" class=\"md-toc-link\"\u003e\u003cp\u003e转换公式\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#屏幕坐标转换为地理坐标\" class=\"md-toc-link\"\u003e\u003cp\u003e屏幕坐标转换为地理坐标\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#地理坐标转换为屏幕坐标\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e地理坐标转换为屏幕坐标\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "}],"type":"book","url":"/chapter/10018_100000"},"chapterInfo":{"id":"10018_100005","type":"chapter","name":"地理坐标与屏幕坐标间的转换原理","fullPath":"D:\\personal\\文档\\passerby\\gis\\WebGIS(三)\\06地理坐标与屏幕坐标间的转换原理.md","url":"/chapter/10018_100005","content":"\n    \n    \n      \u003cdiv class=\"crossnote markdown-preview  \"\u003e\n      \n\u003ch1 id=\"地理坐标与屏幕坐标间的转换原理\"\u003e地理坐标与屏幕坐标间的转换原理 \u003c/h1\u003e\n\u003cp\u003e地图本身是拥有坐标的，一般可以大致分为平面坐标和经纬度坐标，在这里我们统称为地理坐标\u003c/p\u003e\n\u003ch2 id=\"转换前提\"\u003e转换前提 \u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e知道屏幕的最左上角所对应的真实的地理坐标（screenGeoBounds.left, screenGeoBounds.top）。\u003c/li\u003e\n\u003cli\u003e知道此时的地图所在级别上每个瓦片所对应的实际地理长度(sliceLevelLength)。\u003c/li\u003e\n\u003cli\u003e知道瓦片的大小，即一个瓦片所拥有的屏幕像素(tileSize)。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"转换公式\"\u003e转换公式 \u003c/h2\u003e\n\u003ch3 id=\"屏幕坐标转换为地理坐标\"\u003e屏幕坐标转换为地理坐标 \u003c/h3\u003e\n\u003cp\u003egeoXY.x = screenGeoBounds.left + screenX * sliceLevelLength / tileSize;\u003c/p\u003e\n\u003cp\u003egeoXY.y = screenGeoBounds.top - screenY * sliceLevelLength / tileSize;\u003c/p\u003e\n\u003ch4 id=\"地理坐标转换为屏幕坐标\"\u003e地理坐标转换为屏幕坐标 \u003c/h4\u003e\n\u003cp\u003escreenXY.x = (geoX - screenGeoBounds.left)/(sliceLevelLength/ tileSize);\u003c/p\u003e\n\u003cp\u003escreenXY.y = (screenGeoBounds.top - geoY)/(sliceLevelLength/ tileSize);\u003c/p\u003e\n\n      \u003c/div\u003e\n      \u003cdiv class=\"md-sidebar-toc\"\u003e\n\u003cdiv class=\"md-toc\"\u003e\n\u003cdetails style=\"padding:0;;padding-left:0px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#地理坐标与屏幕坐标间的转换原理\" class=\"md-toc-link\"\u003e\u003cp\u003e地理坐标与屏幕坐标间的转换原理\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#转换前提\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e转换前提\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#转换公式\" class=\"md-toc-link\"\u003e\u003cp\u003e转换公式\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdetails style=\"padding:0;;padding-left:24px;\" open=\"\"\u003e\n        \u003csummary class=\"md-toc-link-wrapper\"\u003e\n          \u003ca href=\"#屏幕坐标转换为地理坐标\" class=\"md-toc-link\"\u003e\u003cp\u003e屏幕坐标转换为地理坐标\u003c/p\u003e\n\u003c/a\u003e\n          \u003c/summary\u003e\n        \u003cdiv\u003e\n          \u003cdiv class=\"md-toc-link-wrapper\" style=\"padding:0;;display:list-item;list-style:square;margin-left:42px\"\u003e\n          \u003ca href=\"#地理坐标转换为屏幕坐标\" class=\"md-toc-link\"\u003e\n            \u003cp\u003e地理坐标转换为屏幕坐标\u003c/p\u003e\n\n          \u003c/a\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n        \u003c/div\u003e\n      \u003c/details\u003e\n    \n\u003c/div\u003e\n\u003c/div\u003e\n      \u003ca id=\"sidebar-toc-btn\"\u003e≡\u003c/a\u003e\n    \n    \n    \n    \n    \n    \n\u003cscript\u003e\n\nvar sidebarTOCBtn = document.getElementById('sidebar-toc-btn')\nsidebarTOCBtn.addEventListener('click', function(event) {\n  event.stopPropagation()\n  if (document.body.hasAttribute('html-show-sidebar-toc')) {\n    document.body.removeAttribute('html-show-sidebar-toc')\n  } else {\n    document.body.setAttribute('html-show-sidebar-toc', true)\n  }\n})\n\u003c/script\u003e\n      \n  \n    "}},"__N_SSG":true},"page":"/chapter/[chapterId]","query":{"chapterId":"10018_100005"},"buildId":"delumengma","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>